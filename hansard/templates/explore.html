{% extends "base.html" %}
{% block title %}Explore{% endblock %}
{% block head %}
  {{ super() }}
  <style type="text/css">
  </style>
{% endblock %}

{% block content %}
<h2>Explore</h2>

<div id="input">
	<label for="type">
		Type:
	</label>
	<select id="type" name="type">
	  <option value="mps">MP</option>
	  <option value="quotations">Quotation</option>
	</select>
	
	<label for="entities">
		Entity Analysis
	</label>
	<select id="entities" name="entities">
	  <option value="1">Yes</option>
	  <option value="0">No</option>
	</select>
	
	<label for="sentiment">
		Sentiment Analysis?
	</label>
	<select id="sentiment" name="sentiment">
	  <option value="1">Yes</option>
	  <option value="0">No</option>
	</select>

	<input id="query-btn" type="submit" value="Query">
</div>

<script type="text/template" class="mp_template">
	<div> 
		<a href='/mps/<%= id %>'><%= name %></a>
	</div>
</script>

<script type="text/template" class="quotation_template">
	<div> 
		<a href='/mps/<%= mp %>'>Speaking</a> <a href='/mps/<%= target_mp %>'>To</a> 
		on <%= date %> about <%= business %>
		<% if (typeof entities !== "undefined") { %>
			<div><%= entities %></div>
		<% } %>
		<div><%= text %></div>
	</div>
</script>

<script>
	$('#query-btn').on('click', function() {
		var val = $('#type').val();
		var sentiment = $('#sentiment').val();
		var entities = $('#entities').val();
		var template = $('.quotation_template').html();
		if (val === "mps") {
			template = $('.mp_template').html();
			sentiment = 0;
			entities = 0;
		}
		var compiled = _.template(template);
		$.ajax({
			url : val + "?limit=1" + "&sentiment=" + sentiment + "&entities=" + entities, 
			type: "GET",
			dataType : 'json',
			success : function(response) {
				var data = response.data;
				var $result = $("#result");
				$result.html("");
				_.each(data, function(item) {
					$result.append(compiled(item));
				});
			}
		});
	});

</script>

<div id="result">
</div>
{% endblock %}